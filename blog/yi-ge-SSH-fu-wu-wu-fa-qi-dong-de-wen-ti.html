<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="markdown-hash" content="">

    <title>一个 SSH 服务无法启动的问题</title>

    <link rel="icon" type="image/png" href="/static/favicon.png">
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
<header>
    <div id="go-back" onclick="javascript:history.back(-1);">↼</div>
</header>
<div class="markdown-body">
    <h1>一个 SSH 服务无法启动的问题</h1>
<p>升级了一下 Ubuntu 到18.04.1 升级后重启发现无法 ssh 上去。查看 ssh 端口发现没有启动，就去启动 ssh 服务发现</p>
<pre><code>$ service ssh start
Job for ssh.service failed because the control process exited with error code.
See &quot;systemctl status ssh.service&quot; and &quot;journalctl -xe&quot; for details.
</code></pre>

<p>然后执行<code>systemctl status ssh.service</code> 也并没有给出什么有价值的信息。<br />
通过搜索找到了 <code>/usr/sbin/sshd -T</code> 这个命令，运行后直接可以定位到错误</p>
<pre><code>$ /usr/sbin/sshd -T
......
/etc/sshd/sshd_config line 83: Bad SSH2 cipher spec 'chacha20-poly1305@openssh.com,aes128-gcm@openssh.com,aes256-gcm@openssh.com,aes128-ctr,aes192-ctr,aes256-ctr,aes128-cbc,aes192-cbc,aes256-cbc'.
</code></pre>

<p>是有不支持的 Cipher ,可能是因为刚好升级  OpenSSH 的原因。<br />
这样一来问题就变得好解决了，只需要更新一下配置文件即可，首先查看一下现在支持 Ciphers</p>
<pre><code>$ ssh -Q cipher
3des-cbc
aes128-cbc
aes192-cbc
aes256-cbc
rijndael-cbc@lysator.liu.se
aes128-ctr
aes192-ctr
aes256-ctr
aes128-gcm@openssh.com
aes256-gcm@openssh.com
chacha20-poly1305@openssh.com
</code></pre>

<p>接下来更新到<code>/etc/ssh/sshd_config</code> 文件就好了</p>
<pre><code>Ciphers 3des-cbc,aes128-cbc,aes192-cbc,aes256-cbc,rijndael-cbc@lysator.liu.se,aes128-ctr,aes192-ctr,aes256-ctr,aes128-gcm@openssh.com,aes256-gcm@openssh.com,chacha20-poly1305@openssh.com
</code></pre>

<p>然后启动 ssh 服务就成功了。</p>
<p>当然事情的结尾是，我依然没有能连上，因为 网卡配置莫名的丢了😂，懒得继续折腾了。重装好了。</p>
</div>
<div class="bottom">
    
    <a href="/tag/服务器.html" class="tag" ># 服务器</a>
    
    <time datetime="2018-09-24">2018-09-24</time>
</div>
<footer>
    <a href="/notes.html" target="_blank" class="muted"><i>笔记</i></a>
    <i>/</i>
    <a href="/tags.html" target="_blank" class="muted"><i>标签</i></a>
    <i>/</i>
    <a href="/about.html" target="_blank" class="muted"><i>关于</i></a>
</footer>
<script src="/static/min.js"></script>
</body>
</html>